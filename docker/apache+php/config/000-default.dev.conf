# 000-default.conf - VirtualHost using env var apache_doc_root and classic CGI PHP
# Note: This file expects the placeholder ${apache_doc_root} and ${php_cgi_path}
# to be substituted (for example with envsubst in a Docker entrypoint) to real paths.

<VirtualHost *:${APP_PORT}>
    ServerAdmin webmaster@localhost
    ServerName localhost

    # DocumentRoot should be provided via environment substitution: ${apache_doc_root}
    DocumentRoot "${APACHE_DOCUMENT_ROOT}"

    <Directory "${APACHE_DOCUMENT_ROOT}">
        Options Indexes FollowSymLinks ExecCGI
        AllowOverride All
        Require all granted
    </Directory>

    # Serve PHP files through classic CGI (requires mod_cgi and mod_actions enabled)
    # Set ${php_cgi_path} to the php-cgi binary (for example /usr/bin/php-cgi)
    ScriptAlias /cgi-bin/php-cgi "${php_cgi_path}"

    <IfModule mime_module>
        AddHandler application/x-httpd-php .php
        Action application/x-httpd-php /cgi-bin/php-cgi
    </IfModule>

    # Logs (use Docker-friendly stdout/stderr)
    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 combined
</VirtualHost>