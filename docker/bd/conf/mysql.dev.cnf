[mysqld]  # Sección principal del servidor MySQL

# MySQL Server Configuration for Moodle

# Database Settings
default-storage-engine=InnoDB          # Motor recomendado para rendimiento
character-set-server=utf8mb4           # Codificación por defecto
collation-server=utf8mb4_unicode_ci    # Ordenación Unicode
skip-character-set-client-handshake    # Fuerza UTF-8 en clientes

# Connection Settings
max_connections=200                    # Máx. conexiones simultáneas
max_allowed_packet=64M                 # Tamaño máximo de paquete
connect_timeout=10                     # Tiempo para conectar
wait_timeout=28800                     # Tiempo antes de cerrar conexión inactiva
max_connect_errors=100                 # Errores permitidos antes de bloquear

# Table Cache
table_open_cache=4000                  # Caché de tablas abiertas
table_definition_cache=2000            # Caché de definiciones

# Query Optimization
query_cache_type=0                     # Query cache desactivada
query_cache_size=0                     # Sin espacio para query cache

# InnoDB Settings (recommended for Moodle)
innodb_buffer_pool_size=1G             # Memoria para datos InnoDB
innodb_log_file_size=256M              # Tamaño del log InnoDB
innodb_file_per_table=1                # Tablas en archivos separados
innodb_flush_log_at_trx_commit=2       # Menos I/O por transacción
innodb_flush_method=O_DIRECT           # Evita doble caché
innodb_lock_wait_timeout=50            # Tiempo de espera por bloqueo

# Performance Schema
performance_schema=ON                  # Activa métricas internas
performance_schema_max_table_instances=12500 # Más objetos monitorizados

# Logging
log_error=/var/log/mysql/error.log     # Archivo de errores
slow_query_log=1                       # Activa log de consultas lentas
slow_query_log_file=/var/log/mysql/slow.log # Archivo de consultas lentas
long_query_time=2                      # Tiempo para marcar consulta lenta

# Binlog (for replication/backup)
log_bin=/var/log/mysql/mysql-bin.log   # Archivo de binlog
binlog_format=ROW                      # Formato recomendado
server_id=1                            # ID del servidor
expire_logs_days=10                    # Días antes de borrar binlogs

# Thread Settings
thread_stack=192K                      # Tamaño de pila por hilo
thread_cache_size=16                   # Caché de hilos

# Moodle Specific Optimizations
tmp_table_size=32M                     # Tamaño de tablas temporales
max_heap_table_size=32M                # Tablas en memoria
sort_buffer_size=2M                    # Buffer para ordenaciones
read_buffer_size=2M                    # Buffer de lectura secuencial
read_rnd_buffer_size=8M                # Buffer de lectura aleatoria
join_buffer_size=2M                    # Buffer para JOIN

[mysqldump]  # Configuración para exportaciones
quick                                   # Exportación más rápida
quote-names                             # Escapa nombres
max_allowed_packet=64M                  # Paquetes grandes permitidos
default-character-set=utf8mb4           # Codificación por defecto

[mysql]  # Cliente mysql
default-character-set=utf8mb4           # Codificación UTF-8

[client] # Configuración general de clientes
default-character-set=utf8mb4           # Codificación por defecto
port=3306                               # Puerto estándar
