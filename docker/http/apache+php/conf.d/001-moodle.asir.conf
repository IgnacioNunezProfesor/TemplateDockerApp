# Define un VirtualHost que escucha en el puerto configurado para Moodle
<VirtualHost *:${MOODLE_SERVER_PORT}>

    # Nombre del servidor (dominio o nombre del host)
    ServerName ${MOODLE_SERVER_NAME}

    # Dirección de correo del administrador del servidor
    ServerAdmin you@${MOODLE_SERVER_NAME}

    # Directorio raíz desde el que Apache servirá los archivos de Moodle
    DocumentRoot "${MOODLE_FOLDER_NAME}"

    # Configuración de permisos y opciones para el directorio de Moodle
    <Directory "${MOODLE_FOLDER_NAME}">
        # Permite listar directorios y seguir enlaces simbólicos
        Options Indexes FollowSymLinks

        # Permite que Moodle use archivos .htaccess
        AllowOverride All

        # Permite el acceso a todos los clientes
        Require all granted
    </Directory>

    # Aplica la configuración solo a los archivos con extensión .php
    <FilesMatch \.php$>
        # Indica que los archivos PHP deben ser procesados por PHP
        SetHandler application/x-httpd-php
    </FilesMatch>

    # Define los archivos índice por defecto
    DirectoryIndex index.php index.html info.php

    # Ruta del archivo de log de errores de Apache para este VirtualHost
    ErrorLog /var/log/apache2/error_${MOODLE_SERVER_NAME}.log 

    # Ruta del archivo de log de accesos de Apache para este VirtualHost
    CustomLog /var/log/apache2/access_${MOODLE_SERVER_NAME}.log combined

</VirtualHost>
