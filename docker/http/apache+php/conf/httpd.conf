# Controla qué información del servidor se expone en las respuestas y errores. "OS" incluye el tipo de sistema operativo.
ServerTokens OS
 # Directorio base desde el que Apache busca sus archivos de configuración.
ServerRoot /var/www
# Puerto TCP en el que Apache escucha peticiones HTTP.
Listen 80

# Activa el MPM "prefork": proceso principal con múltiples procesos hijos, cada uno maneja una conexión.
LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
# Permite la autenticación básica de usuarios usando archivos.
LoadModule authn_file_module modules/mod_authn_file.so
# Núcleo de la autenticación: provee infraestructura común para los proveedores de authn.
LoadModule authn_core_module modules/mod_authn_core.so
# Autorización basada en host/IP: directivas como Require host, Require ip.
LoadModule authz_host_module modules/mod_authz_host.so
# Control de acceso según grupos definidos en archivos
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
# Control de acceso según usuarios específicos
LoadModule authz_user_module modules/mod_authz_user.so
# Núcleo para manejar autorización
LoadModule authz_core_module modules/mod_authz_core.so
# Compatibilidad con reglas antiguas de acceso
LoadModule access_compat_module modules/mod_access_compat.so
# Login básico con usuario y contraseña
LoadModule auth_basic_module modules/mod_auth_basic.so
# Evita que conexiones lentas bloqueen el servidor
LoadModule reqtimeout_module modules/mod_reqtimeout.so
# Permite aplicar filtros al contenido web
LoadModule filter_module modules/mod_filter.so
# Asocia extensiones de archivo con tipos MIME
LoadModule mime_module modules/mod_mime.so
# Configura cómo se guardan los registros de acceso
LoadModule log_config_module modules/mod_log_config.so
# Permite usar variables de entorno
LoadModule env_module modules/mod_env.so
# Permite modificar cabeceras HTTP
LoadModule headers_module modules/mod_headers.so
# Cambia variables según condiciones
LoadModule setenvif_module modules/mod_setenvif.so
# Configuración según versión de Apache
LoadModule version_module modules/mod_version.so
# Control de permisos del proceso en sistemas Unix/Linux
LoadModule unixd_module modules/mod_unixd.so
# Activa página de estado del servidor
LoadModule status_module modules/mod_status.so
# Muestra listado de archivos si no hay index.html
LoadModule autoindex_module modules/mod_autoindex.so

# Bloque condicional: si NO está cargado mpm_prefork, entonces...
<IfModule !mpm_prefork_module>
	#LoadModule cgid_module modules/mod_cgid.so     # Carga mod_cgid para MPMs con hilos 
</IfModule>
# Si SÍ se usa prefork...
<IfModule mpm_prefork_module>
	#LoadModule cgi_module modules/mod_cgi.so   # Se carga el CGI clásico
</IfModule>

# Maneja archivos por defecto como index.html
LoadModule dir_module modules/mod_dir.so
# Permite redirigir rutas o crear accesos rápidos
LoadModule alias_module modules/mod_alias.so

# Permite elegir el mejor archivo según idioma o tipo
LoadModule negotiation_module modules/mod_negotiation.so


<IfModule unixd_module>
    User apache     # Usuario del sistema que ejecuta Apache
    Group apache    # Grupo del sistema que ejecuta Apache
</IfModule>

# Email del administrador del servidor para los errores
ServerAdmin you@${SERVER_NAME}
# Muestra una firma del servidor en páginas de error
ServerSignature On
# Nombre del servidor y puerto donde responde
ServerName ${SERVER_NAME}:80

<Directory />
    AllowOverride none      # No se permite sobrescribir configuración con .htaccess
    Require all denied      # Se deniega el acceso a la raíz del sistema
</Directory>

# Carpeta donde están los archivos públicos del sitio web
DocumentRoot "/var/www/localhost/htdocs"

<Directory "/var/www/localhost/htdocs">
    # Permite mostrar listado de archivos y seguir enlaces simbólicos
    Options Indexes FollowSymLinks
    # No se permite usar .htaccess en esta carpeta      
    AllowOverride None
    # Se permite el acceso a esta carpeta
    Require all granted
</Directory>

<IfModule dir_module>
    # Archivos que se usan como página principal si existen
    DirectoryIndex index.html index.php info.php
</IfModule>

<Files ".ht*">
    Require all denied      # Se bloquea el acceso a archivos ocultos como .htaccess
</Files>

# Archivo donde se guardan los errores del servidor
ErrorLog logs/error.log

# Nivel de detalle de los errores: solo advertencias y más graves
LogLevel warn

<IfModule log_config_module>
    # Formato detallado del log de accesos (IP, fecha, petición, estado, tamaño, referer y navegador)
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    # Formato más simple del log (sin referer ni navegador)
    LogFormat "%h %l %u %t \"%r\" %>s %b" common

    <IfModule logio_module>
      # Incluye cantidad de datos recibidos (%I) y enviados (%O)
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio 
    </IfModule>

    # Guarda los accesos en el archivo logs/access.log usando el formato "combined"
    CustomLog logs/access.log combined
</IfModule>

<IfModule alias_module>
    # Asocia la ruta /cgi-bin/ con la carpeta donde están los scripts CGI
    ScriptAlias /cgi-bin/ "/var/www/localhost/cgi-bin/"
</IfModule>

<IfModule cgid_module>
    #
    # ScriptSock: On threaded servers, designate the path to the UNIX
    # socket used to communicate with the CGI daemon of mod_cgid.
    #
    #Scriptsock cgisock
</IfModule>

<Directory "/var/www/localhost/cgi-bin">
    # No se permite usar archivos .htaccess aquí
    AllowOverride None
    # No se permiten opciones especiales
    Options None
    # Se permite el acceso a esta carpeta
    Require all granted
</Directory>

<IfModule headers_module>
    # Elimina la cabecera "Proxy" si viene en la petición
    RequestHeader unset Proxy early
</IfModule>

<IfModule mime_module>
     # Archivo que define tipos MIME según extensión de archivo
    TypesConfig /etc/apache2/mime.types
    # Asocia archivos .Z con el tipo MIME de compresión
    AddType application/x-compress .Z
    # Asocia .gz y .tgz con el tipo MIME gzip
    AddType application/x-gzip .gz .tgz
</IfModule>

<IfModule mime_magic_module>
    # Archivo que ayuda a detectar el tipo de archivo por su contenido
    MIMEMagicFile /etc/apache2/magic
</IfModule>

# Mensaje personalizado para errores internos del servidor (500)
ErrorDocument 500 "The server made a boo boo. Error. 500"
# Página personalizada para errores 404 (no encontrado)
ErrorDocument 404 /missing.html

# Incluye archivos de configuración adicionales si existen en esa carpeta
IncludeOptional /etc/apache2/conf.d/*.conf