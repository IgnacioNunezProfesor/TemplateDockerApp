ServerTokens OS # Muestra el tipo de SO en las cabeceras (menos seguro que 'Prod')
ServerRoot /var/www # Directorio raíz de Apache
Listen 80 # Puerto donde escucha el servidor

LoadModule mpm_prefork_module modules/mod_mpm_prefork.so # Módulo MPM prefork (procesos)
LoadModule authn_file_module modules/mod_authn_file.so # Autenticación basada en archivos
LoadModule authn_core_module modules/mod_authn_core.so # Núcleo de autenticación
LoadModule authz_host_module modules/mod_authz_host.so # Control de acceso por IP/host
LoadModule authz_groupfile_module modules/mod_authz_groupfile.so # Autorización por grupos
LoadModule authz_user_module modules/mod_authz_user.so # Autorización por usuario
LoadModule authz_core_module modules/mod_authz_core.so # Núcleo de autorización
LoadModule access_compat_module modules/mod_access_compat.so # Compatibilidad con reglas antiguas
LoadModule auth_basic_module modules/mod_auth_basic.so # Autenticación básica
LoadModule reqtimeout_module modules/mod_reqtimeout.so # Control de tiempos de petición
LoadModule filter_module modules/mod_filter.so # Filtros de contenido
LoadModule mime_module modules/mod_mime.so # Tipos MIME
LoadModule log_config_module modules/mod_log_config.so # Configuración de logs
LoadModule env_module modules/mod_env.so # Manejo de variables de entorno
LoadModule headers_module modules/mod_headers.so # Manipulación de cabeceras HTTP
LoadModule setenvif_module modules/mod_setenvif.so # Configura variables según condiciones
LoadModule version_module modules/mod_version.so # Permite condicionales por versión
LoadModule unixd_module modules/mod_unixd.so # Manejo de usuario/grupo en Unix
LoadModule status_module modules/mod_status.so # Página de estado del servidor
LoadModule autoindex_module modules/mod_autoindex.so # Listado de directorios

<IfModule !mpm_prefork_module>
    #LoadModule cgid_module modules/mod_cgid.so
</IfModule>

<IfModule mpm_prefork_module>
    #LoadModule cgi_module modules/mod_cgi.so
</IfModule>

LoadModule dir_module modules/mod_dir.so # Manejo de directorios e índices
LoadModule alias_module modules/mod_alias.so # Alias de rutas

LoadModule negotiation_module modules/mod_negotiation.so # Negociación de contenido

<IfModule unixd_module>
    User apache # Usuario del proceso Apache
    Group apache # Grupo del proceso Apache
</IfModule>

ServerAdmin you@${SERVER_NAME} # Email del administrador
ServerSignature On # Muestra firma del servidor en errores
ServerName ${SERVER_NAME}:80 # Nombre del servidor

<Directory />
    AllowOverride none # No permite .htaccess
    Require all denied # Deniega acceso a raíz del sistema
</Directory>

DocumentRoot "/var/www/localhost/htdocs" # Carpeta pública del sitio
<Directory "/var/www/localhost/htdocs">
    Options Indexes FollowSymLinks # Permite listado y enlaces simbólicos
    AllowOverride None # No permite .htaccess
    Require all granted # Acceso permitido
</Directory>

<IfModule dir_module>
    DirectoryIndex index.html index.php info.php # Archivos por defecto
</IfModule>

<Files ".ht*">
    Require all denied # Protege archivos .ht*
</Files>

ErrorLog logs/error.log # Log de errores

LogLevel warn # Nivel de detalle de logs

<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined # Formato detallado
    LogFormat "%h %l %u %t \"%r\" %>s %b" common # Formato común

    <IfModule logio_module>
      # You need to enable mod_logio.c to use %I and %O
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
      # Este bloque solo se ejecuta si el módulo logio está cargado
    </IfModule>

    CustomLog logs/access.log combined # Log de accesos
</IfModule>

<IfModule alias_module>
    ScriptAlias /cgi-bin/ "/var/www/localhost/cgi-bin/" # Alias para scripts CGI
</IfModule>

<IfModule cgid_module>
    #
    # ScriptSock: On threaded servers, designate the path to the UNIX
    # socket used to communicate with the CGI daemon of mod_cgid.
    #
    #Scriptsock cgisock
</IfModule>

<Directory "/var/www/localhost/cgi-bin">
    AllowOverride None # No permite .htaccess
    Options None # Sin opciones especiales
    Require all granted # Acceso permitido
</Directory>

<IfModule headers_module>
    RequestHeader unset Proxy early # Limpia cabecera Proxy
</IfModule>

<IfModule mime_module>
    TypesConfig /etc/apache2/mime.types # Archivo de tipos MIME

    AddType application/x-compress .Z # Tipos adicionales
    AddType application/x-gzip .gz .tgz # Marca .gz y .tgz como archivos gzip
</IfModule>

<IfModule mime_magic_module>
    MIMEMagicFile /etc/apache2/magic # Detección por contenido
</IfModule>

ErrorDocument 500 "The server made a boo boo. Error. 500" # Mensaje personalizado para error 500
ErrorDocument 404 /missing.html # Página personalizada para 404

IncludeOptional /etc/apache2/conf.d/*.conf # Incluye configuraciones adicionales
